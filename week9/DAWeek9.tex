\documentclass[]{article}
\usepackage{lmodern}
\usepackage{amssymb,amsmath}
\usepackage{ifxetex,ifluatex}
\usepackage{fixltx2e} % provides \textsubscript
\ifnum 0\ifxetex 1\fi\ifluatex 1\fi=0 % if pdftex
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
\else % if luatex or xelatex
  \ifxetex
    \usepackage{mathspec}
  \else
    \usepackage{fontspec}
  \fi
  \defaultfontfeatures{Ligatures=TeX,Scale=MatchLowercase}
\fi
% use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
% use microtype if available
\IfFileExists{microtype.sty}{%
\usepackage{microtype}
\UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\usepackage[margin=1in]{geometry}
\usepackage{hyperref}
\hypersetup{unicode=true,
            pdftitle={Generalized Linear Models},
            pdfauthor={Robert Edwards},
            pdfborder={0 0 0},
            breaklinks=true}
\urlstyle{same}  % don't use monospace font for urls
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.77,0.63,0.00}{#1}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\usepackage{longtable,booktabs}
\usepackage{graphicx,grffile}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
\IfFileExists{parskip.sty}{%
\usepackage{parskip}
}{% else
\setlength{\parindent}{0pt}
\setlength{\parskip}{6pt plus 2pt minus 1pt}
}
\setlength{\emergencystretch}{3em}  % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{5}
% Redefines (sub)paragraphs to behave more like sections
\ifx\paragraph\undefined\else
\let\oldparagraph\paragraph
\renewcommand{\paragraph}[1]{\oldparagraph{#1}\mbox{}}
\fi
\ifx\subparagraph\undefined\else
\let\oldsubparagraph\subparagraph
\renewcommand{\subparagraph}[1]{\oldsubparagraph{#1}\mbox{}}
\fi

%%% Use protect on footnotes to avoid problems with footnotes in titles
\let\rmarkdownfootnote\footnote%
\def\footnote{\protect\rmarkdownfootnote}

%%% Change title format to be more compact
\usepackage{titling}

% Create subtitle command for use in maketitle
\newcommand{\subtitle}[1]{
  \posttitle{
    \begin{center}\large#1\end{center}
    }
}

\setlength{\droptitle}{-2em}

  \title{Generalized Linear Models}
    \pretitle{\vspace{\droptitle}\centering\huge}
  \posttitle{\par}
    \author{Robert Edwards}
    \preauthor{\centering\large\emph}
  \postauthor{\par}
      \predate{\centering\large\emph}
  \postdate{\par}
    \date{8 March 2019}

\usepackage{booktabs}
\usepackage{longtable}
\usepackage{array}
\usepackage{multirow}
\usepackage{wrapfig}
\usepackage{float}
\usepackage{colortbl}
\usepackage{pdflscape}
\usepackage{tabu}
\usepackage{threeparttable}
\usepackage{threeparttablex}
\usepackage[normalem]{ulem}
\usepackage{makecell}
\usepackage{xcolor}

\usepackage{float} \floatplacement{figure}{H}

\begin{document}
\maketitle

\section{Introduction}\label{sec:Intro}

In Weeks 3 and 6 we looked at modelling data using linear regression
models where we had:

\begin{itemize}
\tightlist
\item
  a \textbf{continuous response variable \(y\)} and
\item
  one or more \textbf{explanatory variables} \(x_1, x_2, \dots ,x_p\)
  which were \textbf{numerical} and/or \textbf{categorical} variables.
\end{itemize}

Recall that for data \((y_i,x_i), i=1, \dots, n\), where \(y\) is a
continuous response variable, we can write a simple linear regression
model as follows:
\[y_i = \alpha + \beta x_i + \epsilon_i, ~~~ \epsilon_i \sim N(0, \sigma^2)\]

where,

\begin{itemize}
\tightlist
\item
  \(y_i\) is the \(i^{th}\) observation of the continuous response
  variable;
\item
  \(\alpha\) is the \textbf{intercept} of the regression line;
\item
  \(\beta\) is the \textbf{slope} of the regression line;
\item
  \(x_i\) is the \(i^{th}\) observations of the explanatory variable;
\item
  \(\epsilon_i\) is the \(i^{th}\) random component.
\end{itemize}

Thus, the full probability model for \(y_i\) given
\$x\_i(y\_i\textbar{}x\_i) can be written as
\[y_i|x_i \sim N(\alpha + \beta x_i, \sigma^2)\]

where the mean \(\alpha + \beta x_i\) is given by the deterministic part
of the model and the variance \(\sigma^2\) by the random part. Hence we
make the assumption that the outcomes \(y_i\) are normally distributed
with mean \(\alpha + \beta x_i\) and variance \(\sigma^2\). However,
what if our response variable \(y\) is not a continuous random variable?

\subsection{Generalized Linear Models}\label{generalized-linear-models}

The main objective this week is to introduce \textbf{Generalised Linear
Models (GLMs)}, which extend the linear model framework to response
variables that don't follow the normal distribution. GLMs can be used to
model non-normal continuous response variables, but they are most
frequently used to model binary, categorical or count data. Here we
shall focus on binary/categorical response variables. The generalised
linear model can be written as:\\
\[
\begin{aligned}
y_i             &\sim f(g(\mathbf{\mu}_i)) \\
\mathbf{\mu}_i  &= \mathbf{x}^T_i \mathbf{\beta}
\end{aligned}
\]

where the response \(y_i\) is predicted through the linear combination
\(\mathbf{\mu}_i\) of explanatory variables by the link function
\(g(\cdot)\), assuming some distribution \(f(\cdot)\) for \(y_i\), and
\(\mathbf{x}^T_i\) is the \(i^{th}\) row of the design matrix
\(\mathbf{X}\). For example, the simple linear regression model above
for a continuous response variable has the normal distribution as
\(f(\cdot)\), with corresponding link function equal to the identity
function, that is, \(g(\mathbf{\mu}_i) = \mathbf{\mu}_i\).

What if our response variable \(y\) is binary (e.g.~yes/no,
success/failure, alive/dead)? That is, the independent responses \(y_i\)
can either be:

\begin{itemize}
\tightlist
\item
  \textbf{binary}, taking the value 1 (say success, with probability
  \(p_i\)) or 0 (failure, with probability \(1-p_i\)) or
\item
  \textbf{binomial}, where \(y_i\) is the number of successes in a given
  number of trial \(n_i\), with the probability of success being \(p_i\)
  and the probability of failure being \(1-p_i\)
\end{itemize}

In both cases the distribution of \(y_i\) is assumed to be binomial, but
in the first case it is \(\mbox{Bi}(1, p_i)\) and in the second case it
is \(\mbox{Bi}(n_i, p_i)\). Hence, a binary response variable \(y_i\)
has a binomial distribution with corresponding link function
\(g(\cdot)\) equal to the \textbf{logit link} function, that is\\
\[g(p_i) = \mbox{log} \Bigg( \frac{p_i}{1-p_i} \Bigg)\]

which is also referred to as the \textbf{log-odds} (since
\(\frac{p_i}{1-p_i}\) is an odds ratio). Why is such a transformation
required when looking at a binary response variable? Well here we are
interested in modelling the probability of success \(p_i\), and as we
know probabilities must be between 0 and 1 \((p_i \in [0,1])\). So if we
want to model the probability of success using a linear model we need to
ensure that the probabilities obtained are between 0 and 1. However, if
we just use the identity link function, such that
\[p_i = \mathbf{x}^T_i \mathbf{\beta}\]\\
we would need to ensure that in some way
\(\mathbf{x}^T_i \mathbf{\beta} \in [0,1]\) that is, the linear
combination of the explanatory variables and their corresponding
regression coefficients was between 0 and 1. Hence some restrictions of
some sort would need to be put in place to ensure this was the case.
However, if we use the logit link function, such that
\[\mbox{log} \Bigg( \frac{p_i}{1-p_i} \Bigg) = \mathbf{x}^T_i \mathbf{\beta}\]

No restrictions need to be in place on our estimates of the parameter
vector \(\beta\), since the inverse of the logit link function will
always give us valid probabilities since
\[p_i = \frac{\mbox{exp}(\mathbf{x}^T_i \mathbf{\beta})}{1 + \mbox{exp}(\mathbf{x}^T_i \mathbf{\beta})}  ~~~~ \in [0,1]\]

This linear regression model with a binary response variable is referred
to as \textbf{logistic regression}. As such, when it comes to looking at
binary response variables we shall be looking at odds ratios and
probabilities of success/failure. The table below is a reminder of the
distribution and link function used for the normal model we have
previously looked at as well as the logistic regression model we shall
be examining for the rest of this week.

\begin{longtable}[]{@{}lccc@{}}
\toprule
Model & Random Component & Systematic Component & Link
Function\tabularnewline
\midrule
\endhead
Normal & \(y_i \stackrel{indep}{\sim} N(\mu_i,\sigma^2)\) &
\(\mathbf{x}^T_i \mathbf{\beta}=\beta_0+\beta_1x_i+\dots\) &
\(g(\mu_i)=\mu_i\)\tabularnewline
Logistic & \(y_i \stackrel{indep}{\sim} \mbox{Bi}(1,p_i)\) &
\(\mathbf{x}^T_i \mathbf{\beta}=\beta_0+\beta_1x_i+\dots\) &
\(g(\mu_i)=\mbox{log}\bigg(\frac{\mu_i}{1-\mu_i}\bigg)=\mbox{log}\bigg(\frac{p_i}{1-p_i}\bigg)\)\tabularnewline
\bottomrule
\end{longtable}

\newpage

\section{Binary Logistic Regression with One Numerical Explanatory
Variable}\label{binary-logistic-regression-with-one-numerical-explanatory-variable}

Here we shall begin by fitting a logistic regression model with one
numerical explanatory variable. Let's return to the \texttt{evals} data
from the \texttt{moderndive} package that we examined in Week 3.

\subsection{Teaching Evaluation
Scores}\label{teaching-evaluation-scores}

Recall from previous weeks that student feedback in higher education is
extremely important when it comes to the evaluation of teaching
techniques, materials, and improvements in teaching methods and
technologies. However, there have been studies into potential bias
factors when feedback is provided, such as the physical appearance of
the teacher; see Economics of Education Review for details. Here, we
shall return to the study of student evaluations of \(n=463\) professors
from The University of Texas at Austin.

Previously, we looked at \textbf{teaching score} as our continuous
response variable and \textbf{beauty score} as our explanatory variable.
Now we shall consider \textbf{gender} as our response variable, and
hence shall have a binary response variable (female/male). We will
examine if there is any difference in \textbf{gender} by \textbf{age} of
the teaching instructors within the \texttt{evals} data set.

First, let's start by selecting the variables of interest from the
\texttt{evals} data set:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{evals.gender <-}\StringTok{ }\NormalTok{evals }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{select}\NormalTok{(gender, age)}
\end{Highlighting}
\end{Shaded}

Now, let's look at a boxplot of \texttt{age} by \texttt{gender} to get
an initial impression of the data:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ggplot}\NormalTok{(}\DataTypeTok{data =}\NormalTok{ evals.gender, }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ gender, }\DataTypeTok{y =}\NormalTok{ age, }\DataTypeTok{fill =}\NormalTok{ gender)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_boxplot}\NormalTok{() }\OperatorTok{+}
\StringTok{  }\KeywordTok{labs}\NormalTok{(}\DataTypeTok{x =} \StringTok{"Gender"}\NormalTok{, }\DataTypeTok{y =} \StringTok{"Age"}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{theme}\NormalTok{(}\DataTypeTok{legend.position =} \StringTok{"none"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics[width=0.5\linewidth]{DAWeek9_files/figure-latex/boxplot1-1} 

}

\caption{\label{fig.plot1}Teaching instructor age by gender}\label{fig:boxplot1}
\end{figure}

Here we can see that the male teaching instructors tend to be older than
that of their female colleagues. Now, let's fit a logistic regression
model to see whether age is a significant predictor of the odds of a
teaching instructor being male or female.

\subsection{Log-odds}\label{log-odds}

To fit a logistic regression model we will use the generalised linear
model function \texttt{glm}, which acts in a very similar manner to the
\texttt{lm} function we have used previously. We only have to deal with
an additional argument. The logistic regression model with
\textbf{gender} as the response and \textbf{age} as the explanatory
variable is given by:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{model <-}\StringTok{ }\KeywordTok{glm}\NormalTok{(gender }\OperatorTok{~}\StringTok{ }\NormalTok{age, }\DataTypeTok{data =}\NormalTok{ evals.gender, }\DataTypeTok{family =} \KeywordTok{binomial}\NormalTok{(}\DataTypeTok{link =} \StringTok{"logit"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

Here we include the additional \texttt{family} argument, which states
the distribution and link function we would like to use. Hence
\texttt{family\ =\ binomial(link\ =\ "logit")} states we have a binary
response variable, and thus have a binomial distribution, with its
corresponding \textbf{logit link} function. Now, let's take a look at
the summary produced from our logistic regression model:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{model }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{summary}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}

Call:
glm(formula = gender ~ age, family = binomial(link = "logit"), 
    data = evals.gender)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-1.7134  -1.1815   0.7238   1.0180   1.4778  

Coefficients:
            Estimate Std. Error z value Pr(>|z|)    
(Intercept) -2.69795    0.51194  -5.270 1.36e-07 ***
age          0.06296    0.01059   5.948 2.71e-09 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 630.30  on 462  degrees of freedom
Residual deviance: 591.41  on 461  degrees of freedom
AIC: 595.41

Number of Fisher Scoring iterations: 4
\end{verbatim}

Firstly, the baseline category for our binary response is
\texttt{female}. This is due to the default baseline in R being taken as
the one which comes first alphabetically, which can be seen from the
\texttt{levels} function:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{levels}\NormalTok{(evals.gender}\OperatorTok{$}\NormalTok{gender)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "female" "male"  
\end{verbatim}

This means that estimates from the logistic regression model are for a
change on the \textbf{log-odds} scale for \texttt{males} in comparison
to the response baseline \texttt{females}. That is
\[\mbox{ln} \bigg( \frac{p}{1-p} \bigg) = \alpha + \beta \cdot \mbox{age} = -2.7 + 0.06 \cdot \mbox{age}\]

where \(p = \mbox{Prob(Male)}\) and \(1-p = \mbox{Prob(Female)}\).
Hence, the \textbf{log-odds} of the instructor being male increase by
0.06 for every one unit increase in \texttt{age}. This provies us with a
point estimate of how the log-odds changes with age, however, we are
also interested in producing a 95\% confidence interval for these
log-odds. This can be done using the \texttt{confit} function in the
\texttt{MASS} package:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{confint}\NormalTok{(model) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{kable}\NormalTok{(}\DataTypeTok{booktabs =} \OtherTok{TRUE}\NormalTok{) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{kable_styling}\NormalTok{(}\DataTypeTok{latex_options =} \StringTok{"hold_position"}\NormalTok{,}
                \DataTypeTok{format =} \StringTok{"latex"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{confint}\NormalTok{(model)}
\end{Highlighting}
\end{Shaded}

To understand how these endpoints are calculated, consider the following
code:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mod.coef.logodds <-}\StringTok{ }\NormalTok{model }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{summary}\NormalTok{() }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{coef}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{age.logodds.lower <-}\StringTok{ }\NormalTok{mod.coef.logodds[}\StringTok{"age"}\NormalTok{, }\StringTok{"Estimate"}\NormalTok{] }\OperatorTok{-}\StringTok{ }\FloatTok{1.96} \OperatorTok{*}\StringTok{ }\NormalTok{mod.coef.logodds[}\StringTok{"age"}\NormalTok{, }\StringTok{"Std. Error"}\NormalTok{]}
\NormalTok{age.logodds.upper <-}\StringTok{ }\NormalTok{mod.coef.logodds[}\StringTok{"age"}\NormalTok{, }\StringTok{"Estimate"}\NormalTok{] }\OperatorTok{+}\StringTok{ }\FloatTok{1.96} \OperatorTok{*}\StringTok{ }\NormalTok{mod.coef.logodds[}\StringTok{"age"}\NormalTok{, }\StringTok{"Std. Error"}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

Hence the point estimate for the log-odds is 0.06, which has a
corresponding 95\% confidence interval of (0.04, 0.08). This can be
displayed graphically using the \texttt{plot\_model} function from the
\texttt{sjPlot} package simply passing our \texttt{model} as an
argument:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{plot_model}\NormalTok{(model, }\DataTypeTok{show.values =} \OtherTok{TRUE}\NormalTok{, }\DataTypeTok{transform =} \OtherTok{NULL}\NormalTok{, }\DataTypeTok{title =} \StringTok{"Log-Odds (Male instructor)"}\NormalTok{, }\DataTypeTok{show.p =} \OtherTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics[width=0.5\linewidth]{DAWeek9_files/figure-latex/plot2-1} 

}

\caption{\label{fig.plot2}The log-Odds of age for Male instructors}\label{fig:plot2}
\end{figure}

Some of the interesting arguments that can be passed to the
\texttt{plot\_model} function are:

\begin{itemize}
\tightlist
\item
  \texttt{show.values} = TRUE/FALSE`: Whether the log-odds/odds values
  should be displayed;
\item
  \texttt{show.p\ =\ TRUE/FALSE}: Adds asterisks that indicate the
  significance level of estimates to the value labels;
\item
  \texttt{transform}: A character vector naming the function that will
  be applied to the estimates. The default transformation uses exp to
  display the odds ratios, while transform = NULL displays the log-odds;
  and
\item
  \texttt{vline.color}: colour of the vertical ``zero effect'' line.
\end{itemize}

Further details on using \texttt{plot\_model} can be found
\href{https://strengejacke.wordpress.com/2017/10/23/one-function-to-rule-them-all-visualization-of-regression-models-in-rstats-w-sjplot/}{here}
and \href{https://strengejacke.github.io/sjPlot/index.html}{here}

Now, let's add the estimates of the log-odds to our data set:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{evals.gender <-}\StringTok{ }\NormalTok{evals.gender }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{logodds.male =} \KeywordTok{predict}\NormalTok{(model))}
\end{Highlighting}
\end{Shaded}

\textbf{What is the log-odds of a 63 year old instructor being male?}

\begin{itemize}
\tightlist
\item
  The log-odds of a 62 year-old instructor being male is 1.21
\end{itemize}

\textbf{What is the log-odds of a 29 year old instructor being male?}

\begin{itemize}
\tightlist
\item
  The log-odds of a 29 year-old instructor being male is -0.87
\end{itemize}

\subsection{Odds}\label{odds}

Typically we would like to work on the \textbf{odds} scale as it is
easier to interpret an odds-ratio as opposed to the log-odds-ratio. To
obatin the odds we simply exponentiate the log-odds, that is
\[\frac{p}{1-p} = \mbox{exp}(\alpha + \beta \cdot \mbox{age})\]

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{model }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{coef}\NormalTok{() }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{exp}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
(Intercept)         age 
 0.06734369  1.06498927 
\end{verbatim}

On the odds scale, the value of the intercept (0.07) gives the odds of a
teaching instructor being male given their \texttt{age\ =\ 0}, which is
obviously not a viable age for a teaching instructor, and hence why this
value is very close to zero. For \texttt{age} we have an odds of 1.06,
which indicates that for every 1 unit increase in age, the odds of the
teaching instructor being male increase by a factor of 1.06. So how is
this calculated? Let's look at the odds-ratio obtained from instructors
aged 51 to 52 years old, that is, a 1 units difference:
\[\frac{\mbox{Odds}_{\mbox{age=52}}}{\mbox{Odds}_{\mbox{age=51}}} = \Bigg( \frac{ \frac{p_{age=52}}{1-p_{age=52}} } { \frac{p_{age=51}}{1-p_{age=51}} } \Bigg) = \frac{\mbox{exp}(\alpha + \beta \cdot 52)}{\mbox{exp}(\alpha + \beta \cdot 51)} = {\mbox{exp}(\beta \cdot (52 - 51))}\]

For example, the odds of a teaching instructor who is 45 years old being
male is given by
\[\frac{p}{1-p}= \mbox{exp}(\alpha + \beta \cdot \mbox{age}) = \mbox{exp}( 0.07 + 1.06 \cdot 45) = 48\]

This can be interpreted as the chances of an instructor who is 45 being
a male are 15\% greater than them being female. We can obtain a 95\%
confidence interval for the odds by simply exponentiating the lower and
upper bounds of our log-odds interval.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{age.odds.lower <-}\StringTok{ }\KeywordTok{exp}\NormalTok{(age.logodds.lower)}
\NormalTok{age.odds.upper <-}\StringTok{ }\KeywordTok{exp}\NormalTok{(age.logodds.upper)}
\end{Highlighting}
\end{Shaded}

Hence the point estimate for the odds is 0.07, which has a corresponding
95\% confidence interval of (1.04, 1.09). This can be displayed
graphically using the \texttt{plot\_model} function from the
\texttt{sjPlot} package by simply passing our \texttt{model} as an
argument as well as removing \texttt{transform\ =\ NULL} (the default
transformation is exponential):

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{plot_model}\NormalTok{(model, }\DataTypeTok{show.values =} \OtherTok{TRUE}\NormalTok{, }\DataTypeTok{axis.lim =} \KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\FloatTok{1.5}\NormalTok{), }
           \DataTypeTok{title =} \StringTok{"Odds (Male instructor)"}\NormalTok{, }\DataTypeTok{show.p =} \OtherTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics[width=0.5\linewidth]{DAWeek9_files/figure-latex/plot3-1} 

}

\caption{\label{fig.plot3}The odds of age for Male instructors}\label{fig:plot3}
\end{figure}

\textbf{Note}: As the 95\% confidence interval is so narrow it is hard
to see it displayed in the plot, but it is included by default. The
\texttt{axis.lim\ =\ c(1,1.5)} argument improves its visibility as seen
here.

Now, let's add the estimates of the odds to our data set:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{evals.gender <-}\StringTok{ }\NormalTok{evals.gender }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{odds.male =} \KeywordTok{exp}\NormalTok{(logodds.male))}
\end{Highlighting}
\end{Shaded}

\textbf{What is the odds of a 47 year old instructor being male?}

\begin{itemize}
\tightlist
\item
  The log-odds of a 62 year-old instructor being male is 1.3
\end{itemize}

\textbf{What is the log-odds of a 56 year old instructor being male?}

\begin{itemize}
\tightlist
\item
  The odds of a 56 year-old instructor being male is 2.29
\end{itemize}

\subsection{Probabilities}\label{probabilities}

We can obtain the probability \(p=\mbox{Prob(Male)}\) using the
following transformation:
\[p = \frac{\mbox{exp}(\alpha + \beta \cdot \mbox{age})}{1 + \mbox{exp}(\alpha + \beta \cdot \mbox{age})}\]

For example, the probabilit of a teaching instructor who is 52 years old
being male is

\[p = \frac{\mbox{exp}(\alpha + \beta \cdot \mbox{age})}{1 + \mbox{exp}(\alpha + \beta \cdot \mbox{age})} = \frac{\mbox{exp}(-2.697946 + 0.0629647 \cdot \mbox{52})}{1 + \mbox{exp}(-2.697946 + 0.0629647 \cdot \mbox{52})}\]

which can be computed in R as follows:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{p.num <-}\StringTok{ }\KeywordTok{exp}\NormalTok{(mod.coef.logodds[}\StringTok{"(Intercept)"}\NormalTok{, }\StringTok{"Estimate"}\NormalTok{] }\OperatorTok{+}\StringTok{ }
\StringTok{               }\NormalTok{mod.coef.logodds[}\StringTok{"age"}\NormalTok{, }\StringTok{"Estimate"}\NormalTok{] }\OperatorTok{*}\StringTok{ }\DecValTok{52}\NormalTok{)}
\NormalTok{p.denom <-}\StringTok{ }\DecValTok{1} \OperatorTok{+}\StringTok{ }\NormalTok{p.num}
\NormalTok{p.num}\OperatorTok{/}\NormalTok{p.denom}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 0.6401971
\end{verbatim}

The \texttt{plogis()} function from the \texttt{stats} library can also
be used to obtain probabilities from the log-odds:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{plogis}\NormalTok{(mod.coef.logodds[}\StringTok{"(Intercept)"}\NormalTok{, }\StringTok{"Estimate"}\NormalTok{] }\OperatorTok{+}\StringTok{ }
\StringTok{         }\NormalTok{mod.coef.logodds[}\StringTok{"age"}\NormalTok{, }\StringTok{"Estimate"}\NormalTok{] }\OperatorTok{*}\StringTok{ }\DecValTok{52}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 0.6401971
\end{verbatim}

Let's add the probabilities to our data, which is done using the
\texttt{fitted()} function:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{evals.gender <-}\StringTok{ }\NormalTok{evals.gender }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{probs.male =} \KeywordTok{fitted}\NormalTok{(model))}
\end{Highlighting}
\end{Shaded}

**Note*: \texttt{predict(model,\ type\ =\ "response")} will also provide
the estimated probabilities.

\textbf{What is the probability of a 3 year old instructor being
female?}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{q5 <-}\StringTok{ }\NormalTok{evals.gender }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{filter}\NormalTok{(age }\OperatorTok{==}\StringTok{ }\DecValTok{33}\NormalTok{, gender }\OperatorTok{==}\StringTok{ "female"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  The log-odds of a 33 year-old instructor being female is 0.65
\end{itemize}

\textbf{What is the log-odds of a 47 year old instructor being male?}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{q6 <-}\StringTok{ }\NormalTok{evals.gender }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{filter}\NormalTok{(age }\OperatorTok{==}\StringTok{ }\DecValTok{47}\NormalTok{, gender }\OperatorTok{==}\StringTok{ "male"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  The odds of a 47 year-old instructor being male is 0.56
\end{itemize}

Finally, we can plot the probability of being male using the
\texttt{geom\_smooth()} function by giving \texttt{method\ =\ "glm"} and
\texttt{methods.args\ =\ list(family\ =\ "binomial")} as follows:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{evals.gender <-}\StringTok{ }\NormalTok{evals.gender }\OperatorTok{%>%}
\StringTok{                  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{probs.male =} \KeywordTok{fitted}\NormalTok{(model))}

\KeywordTok{ggplot}\NormalTok{(}\DataTypeTok{data =}\NormalTok{ evals.gender, }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ age, }\DataTypeTok{y =}\NormalTok{ probs.male)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_dotplot}\NormalTok{(}\DataTypeTok{dotsize =} \FloatTok{0.6}\NormalTok{, }\DataTypeTok{alpha =} \FloatTok{0.2}\NormalTok{, }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{fill =}\NormalTok{ gender), }
               \DataTypeTok{binwidth =} \DecValTok{1}\NormalTok{, }\DataTypeTok{stackgroups =} \OtherTok{TRUE}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_smooth}\NormalTok{(}\DataTypeTok{method =} \StringTok{"glm"}\NormalTok{,}
              \DataTypeTok{method.args =} \KeywordTok{list}\NormalTok{(}\DataTypeTok{family =} \StringTok{"binomial"}\NormalTok{),}
              \DataTypeTok{se =} \OtherTok{FALSE}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{labs}\NormalTok{(}\DataTypeTok{x =} \StringTok{"Age"}\NormalTok{, }\DataTypeTok{y =} \StringTok{"Probability of instructor being male"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\textbf{Note}: the ages of all teaching instructors have been
superimposed as a dotplot using \texttt{geom\_dotplot()}.

The \texttt{plot\_model()} function from the \texttt{sjPlot} package can
also produce the estimated probabilities by \texttt{age} as follows:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{plot_model}\NormalTok{(model, }\DataTypeTok{type =} \StringTok{"pred"}\NormalTok{, }\DataTypeTok{title =} \StringTok{""}\NormalTok{, }
           \DataTypeTok{axis.title =} \KeywordTok{c}\NormalTok{(}\StringTok{"Age"}\NormalTok{, }\StringTok{"Prob. of instructor being male"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
$age
\end{verbatim}

\begin{figure}

{\centering \includegraphics[width=0.5\linewidth]{DAWeek9_files/figure-latex/plot5-1} 

}

\caption{\label{fig.plot5}Probability of teaching instructor being male by age}\label{fig:plot5}
\end{figure}


\end{document}
